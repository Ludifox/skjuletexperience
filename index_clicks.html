<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historier fra sofaen - en interaktiv reise med historier fra sofaen</title>
    <link href="sofahistorier_click.css" rel="stylesheet" media="all">
    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <script src="leaflet/leaflet.js"></script>
    <script src="snakeAnim.js"></script>
</head>
<body>
    <img id="logo" src="img/GiS_logo_white.svg" />
    <header>
        <section>
            <h1>Velkommen til en musikalsk reise...</h1>
            <a href="#mapStory" id="introbutton"><img src="img/planeicon.png" alt="Start reisen" />Start</a>
        </section>
    </header>
    <section id="mapStory">
        <section id="storyContainer" class="scrollcontainer">
            <article id="infoBox">
                <h2>
                    <span class="from">
                        <span class="from-place">Halden</span>
                        <span class="from-country">Norge</span>
                    </span>
                    <span class="arrow">&gt;</span>
                    <span class="to">
                        <span class="to-place">Cuba</span>
                        <span class="to-country">Karibia</span>
                    </span>
                </h2>
                <p>Du har nå fått billett til en reise med Skjulets første album, hvor Egil og Marius har fablet seg gjennom Europa og
                    Amerika.</p>
                <p>Historiene har ikke rot i virkeligheten, de er rot i virkeligheten. Gjennom en reise i både tid og rom har Egil og
                    Marius både opplevd - og startet - viktige hendelser i verdenshistorien!</p>
                <p>Så spenn fast setebeltet og scroll nedover for en online musikalsk eventyrfortelling...</p>
                <nav id="infoBoxNav">
                    <button id="previous">Forrige</button>
                    <button id="next">Neste</button>
                </nav>
            </article>
        </section>
        <section id="mapContainer"></section>
    </section-->
    <script>
        if(global === undefined) {
            var global = window;
        }

        //DATASET
        const journeydata = [
            {
                city: "Halden", 
                country: "Norge", 
                songtitle: "Historier fra sofaen (album)",
                lat: 59.1246, 
                long: 11.3877, 
                icon: L.icon({
                    iconUrl: 'img/icons/home-address-50.png',
                    iconSize: [50,50],
                    iconAnchor: [0,0],
                    popupAnchor: [0,0]
                }),
                pathcolor: "#b61010"
            },
            {
                city: "Sagua la Grande", 
                country: "Cuba", 
                songtitle: "Krise på Cuba",
                lat: 22.9119, 
                long: -80.0723, 
                icon: L.icon({
                    iconUrl: 'img/icons/explosion-50.png',
                    iconSize: [50,50],
                    iconAnchor: [90,50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#002590"
            },
            {
                city: "Amsterdam", 
                country: "Nederland", 
                songtitle: "Alternativt arbeid i Amsterdam",
                lat: 52.3547, 
                long: 4.9040, 
                icon: L.icon({
                    iconUrl: 'img/icons/sex-worker-50.png',
                    iconSize: [50,50],
                    iconAnchor: [90,50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#ff9b00"
            },
            {
                city: "Acapulco",
                country: "Mexico",
                songtitle: "Apocalypso i Acapulco",
                lat: 16.8681,
                long: -99.8940,
                icon: L.icon({
                    iconUrl: 'img/icons/bribery-50.png',
                    iconSize: [50, 50],
                    iconAnchor: [90, 50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#006341"
            },
            {
                city: "Ciudad Juarez", 
                country: "Mexico", 
                songtitle: "Mur mot Mexico",
                lat: 31.7374, 
                long: -106.4857, 
                icon: L.icon({
                    iconUrl: 'img/icons/bribery-50.png',
                    iconSize: [50,50],
                    iconAnchor: [90,50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#006341"
            },
            {
                city: "Favela, Ciudad de Mexico", 
                country: "Mexico", 
                songtitle: "Fest i Favela",
                lat: 19.3568, 
                long: -99.2097, 
                icon: L.icon({
                    iconUrl: 'img/icons/moonshine-jug-50.png',
                    iconSize: [50,50],
                    iconAnchor: [90,50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#006341"
            },
            {
                city: "Berlin", 
                country: "Tyskland", 
                songtitle: "Bygning i Berlin",
                lat: 52.5072, 
                long: 13.4248, 
                icon: L.icon({
                    iconUrl: 'img/icons/suitcase-50.png',
                    iconSize: [50,50],
                    iconAnchor: [90,50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#000000"
            },
            {
                city: "Bucuresti", 
                country: "Romania", 
                songtitle: "Bucuresti Blues",
                lat: 44.4379, 
                long: 26.0961, 
                icon: L.icon({
                    iconUrl: 'img/icons/error-50.png',
                    iconSize: [50,50],
                    iconAnchor: [90,50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#fcd116"
            },
            {
                city: "Transylvania", 
                country: "Romania", 
                songtitle: "Tivoli i Transylvania",
                lat: 46.5971, 
                long: 24.3740, 
                icon: L.icon({
                    iconUrl: 'img/icons/theme-park-50.png',
                    iconSize: [50,50],
                    iconAnchor: [90,50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#fcd116"
            },
            {
                city: "Bagdad",
                country: "Irak",
                songtitle: "Bakfull i Bagdad",
                lat: 33.3334,
                long: 44.3775,
                icon: L.icon({
                    iconUrl: 'img/icons/purchase-order-50.png',
                    iconSize: [50, 50],
                    iconAnchor: [90, 50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#ce1126"
            },
            {
                city: "Telemark",
                country: "Norge",
                songtitle: "Tungtvann i Telemark",
                lat: 59.8710,
                long: 8.4937,
                icon: L.icon({
                    iconUrl: 'img/icons/radioactive-50.png',
                    iconSize: [50, 50],
                    iconAnchor: [90, 50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#003987"
            },
            {
                city: "Blokksberg",
                country: "Tyskland",
                songtitle: "Frierferd langt fandenivold",
                lat: 51.79913,
                long: 10.61564,
                icon: L.icon({
                    iconUrl: 'img/icons/alps-50.png',
                    iconSize: [50, 50],
                    iconAnchor: [90, 50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#000000"
            },
            {
                city: "Örebro",
                country: "Sverige",
                songtitle: "Øresus i Örebro",
                lat: 59.27417,
                long: 15.20997,
                icon: L.icon({
                    iconUrl: 'img/icons/cocktail-50.png',
                    iconSize: [50, 50],
                    iconAnchor: [90, 50],
                    popupAnchor: [0, -20]
                }),
                pathcolor: "#006aa7"
            },
           {
                city: "Halden",
                country: "Norge",
                songtitle: "Hekta i Halden",
                lat: 59.1246,
                long: 11.3877,
                icon: L.icon({
                    iconUrl: 'img/icons/prison-50.png',
                    iconSize: [50, 50],
                    iconAnchor: [0, 0],
                    popupAnchor: [0, 0]
                }),
                pathcolor: "#003987"
            }
        ]
        //INITIATE MAP
        let map = L.map('mapContainer', {
            renderer: L.canvas(),
            center: [journeydata[0].lat, journeydata[0].long],
            zoom: 4,
            scrollWheelZoom: false
        })
        //SET MAP CONSTRUCTOR
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 25,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);
        //SET INITAL MARKER
        const haldenMarker = L.marker([journeydata[0].lat, journeydata[0].long], {icon: journeydata[0].icon}).bindPopup("Halden").addTo(map)

        let currentIndex = 0;

        //Load info
        function loadInfo(index) {
            const prev = index -1
            const next = index + 1

            const h2structure = `<span class="from">
                            <span class="from-place">${journeydata[prev].city}</span>
                            <span class="from-country">${journeydata[prev].country}</span>
                        </span>
                        <span class="arrow">&gt;</span>
                        <span class="to">
                            <span class="to-place">${journeydata[index].city}</span>
                            <span class="to-country">${journeydata[index].city}</span>
                        </span>`
            const h2elem = document.querySelector("#infoBox h2")
            h2elem.innerHTML = h2structure

            //buttons
            document.getElementById("previous").innerHTML = `<span class="from-country">Forrige</span>
            <span class="from-place">${journeydata[prev].city}</span>
                            <span class="from-country">${journeydata[prev].country}</span>`
            document.getElementById("next").innerHTML = `<span class="to-country">Neste</span>
            <span class="to-place">${journeydata[next].city}</span>
                            <span class="to-country">${journeydata[next].country}</span>`
        }
        
        //Feel the click
        document.addEventListener("click", function(event) {
            if(event.target.id === "next") {
                currentIndex++
                travel(currentIndex)
                loadInfo(currentIndex)
            }
        })

        //FUNCTION TO ADD TRAVEL ROUTES
        function travel(index) {
            const from = journeydata[index - 1]
            const to = journeydata[index]
            const pathstyle = {color: to.pathcolor, weight: '2',  dashArray: '5, 5', dashOffset: '5'}

            L.marker([to.lat, to.long], {icon: to.icon}).addTo(map)
            

            let srcLatRad = from.lat  * (Math.PI / 180);
            let dstLatRad = to.lat  * (Math.PI / 180);
            let middleLatRad = Math.atan(Math.sinh(Math.log(Math.sqrt(
            (Math.tan(dstLatRad)+1/Math.cos(dstLatRad))*(Math.tan(srcLatRad)+1/Math.cos(srcLatRad))))));
            let middleLat = middleLatRad * (180 / Math.PI)
            let middleLong = (from.long + to.long) / 2;

            map.flyTo([to.lat, to.long], 4, {
                animate: true,
                duration: 3
            })
            map.on('zoomend', function() {
                L.polyline([[from.lat, from.long], [to.lat, to.long]], pathstyle, { snakingSpeed: 2000 }).addTo(map).snakeIn()
            })
            
        }

        //Function to check if element is in viewport
        function isInViewport(el) {
            const rect = el.getBoundingClientRect();
            return (
                (rect.top <= 0 && rect.bottom >= 0) || 
                (rect.top >= 0 &&
                rect.left >= 0 &&
                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                rect.right <= (window.innerWidth || document.documentElement.clientWidth))
            );
        }

        loadInfo(currentIndex)

        //SCRIPT FOR CHANGING MAP LOCATION
        document.addEventListener('scroll', function () {
            if(isInViewport(document.getElementById("cuba"))) {
                travel(1)
            }
            if(isInViewport(document.getElementById("amsterdam"))) {
                travel(2)
            }6
            if(isInViewport(document.getElementById("acapulco"))) {
                travel(3)
            }
            if(isInViewport(document.getElementById("mexico"))) {
                travel(4)
            }
            if(isInViewport(document.getElementById("favela"))) {
                travel(5)
            }
            if(isInViewport(document.getElementById("berlin"))) {
                travel(6)
            }
            if(isInViewport(document.getElementById("bucuresti"))) {
                travel(7)
            }
            if(isInViewport(document.getElementById("transylvania"))) {
                travel(8)
            }
            if (isInViewport(document.getElementById("bagdad"))) {
                travel(9)
            }
            if (isInViewport(document.getElementById("telemark"))) {
                travel(10)
            }
            if (isInViewport(document.getElementById("fandenivold"))) {
                travel(11)
            }
            if (isInViewport(document.getElementById("orebro"))) {
                travel(12)
            }
            if (isInViewport(document.getElementById("halden"))) {
                travel(13)
            }
            if (isInViewport(document.getElementById("summary"))) {
                map.flyTo([37.353,-46.824], 2)
            }
        }, {
            passive: true
        });
    </script>
</body>
</html>